#!/bin/sh

echo "Running pre-commit checks..."

# Run linter
npm run lint
if [ $? -ne 0 ]; then
  echo "Lint failed. Fix errors before committing."
  exit 1
fi

# Run TypeScript check
npx tsc --noEmit
if [ $? -ne 0 ]; then
  echo "TypeScript errors found. Fix before committing."
  exit 1
fi

# Check for console.log statements (warn only)
if git diff --cached --name-only | xargs grep -l 'console.log' 2>/dev/null; then
  echo "Warning: console.log statements found in staged files"
fi

# Update session state
../scripts/update-session.sh "Pre-commit: $(git log -1 --pretty=%B 2>/dev/null || echo 'new commit')" "claude-code"

echo "Pre-commit checks passed"
